{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<h2>{{ post.title }}</h2>

{% if post.image %}
    <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 400px;">
{% endif %}

<p><strong>–ê–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏:</strong> {{ post.book_author }}</p>
<p><strong>–¶–µ–Ω–∞:</strong> {{ post.price }} ‚ÇΩ</p>
<p><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> {{ post.get_condition_display }}</p>
<p><strong>–ñ–∞–Ω—Ä:</strong> 
    <a href="{% url 'books:category_posts' post.category.slug %}">{{ post.category.title }}</a>
</p>
<p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> 
    <a href="{% url 'books:profile' post.author.username %}">{{ post.author.username }}</a>
</p>
<p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ post.location.name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
<p><em>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.pub_date|date:"d.m.Y H:i" }}</em></p>

<hr>
<h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
<p>{{ post.text }}</p>

{% if user == post.author %}
    <p>
        <a href="{% url 'books:post_edit' post.id %}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> | 
        <a href="{% url 'books:post_delete' post.id %}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    </p>
{% endif %}

<hr>
<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments.count }})</h3>

{% if user.is_authenticated %}
    <form method="post" action="{% url 'books:add_comment' post.id %}">
        {% csrf_token %}
        <textarea name="text" rows="3" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required style="width: 100%;"></textarea>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
{% else %}
    <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
{% endif %}

<hr>
{% for comment in post.comments.all %}
    <div style="border-left: 3px solid #555; padding-left: 10px; margin: 10px 0;">
        <p><strong>{{ comment.author.username }}</strong> <em>({{ comment.created_at|date:"d.m.Y H:i" }})</em></p>
        <p>{{ comment.text }}</p>
        
        {% if user == comment.author %}
            <a href="{% url 'books:edit_comment' post.id comment.id %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> | 
            <a href="{% url 'books:delete_comment' post.id comment.id %}">–£–¥–∞–ª–∏—Ç—å</a>
        {% endif %}
    </div>
{% empty %}
    <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}
{% endblock %}
